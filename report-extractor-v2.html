<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>מחלץ דוחות PDF</title>

<!-- ספריות חיצוניות -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";</script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body{font-family:Heebo,Arial,sans-serif;background:#f6f7fb;color:#111;margin:0;padding:20px;direction:rtl}
.card{background:#fff;border-radius:16px;box-shadow:0 3px 10px rgba(0,0,0,.1);padding:20px;max-width:900px;margin:auto}
button{background:#0d6efd;color:#fff;border:none;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:600}
#progress{height:10px;background:#eee;border-radius:6px;margin-top:10px}
#bar{height:100%;background:#0d6efd;width:0%;transition:width .2s}
#output{background:#0f172a;color:#e2e8f0;font-family:ui-monospace,monospace;padding:10px;border-radius:10px;margin-top:15px;white-space:pre-wrap;max-height:200px;overflow:auto}
</style>
</head>
<body>

<div class="card">
  <h2>מחלץ דוחות – שלב ראשון</h2>
  <input type="file" id="file" accept=".pdf,image/*">
  <button id="extractBtn">חלץ טקסט</button>
  <div id="progress"><div id="bar"></div></div>
  <p id="status"></p>
  <div id="output"></div>
</div>

<script>
const f=document.getElementById("file"),btn=document.getElementById("extractBtn"),
s=document.getElementById("status"),bar=document.getElementById("bar"),
out=document.getElementById("output");
const setStatus=(t,c)=>{s.textContent=t;s.style.color=c||"#111"};
btn.onclick=async()=>{
  if(!f.files[0])return setStatus("בחר קובץ קודם","#c00");
  const file=f.files[0];
  const ext=file.name.split(".").pop().toLowerCase();
  const isPDF=ext==="pdf";
  let text="";
  try{
    if(isPDF){
      setStatus("טוען PDF...");bar.style.width="10%";
      const ab=await file.arrayBuffer();
      const pdf=await pdfjsLib.getDocument({data:ab}).promise;
      let pages="";
      for(let i=1;i<=pdf.numPages;i++){
        const page=await pdf.getPage(i);
        const content=await page.getTextContent();
        const str=content.items.map(it=>it.str).join(" ");
        pages+=str+"\n";
        bar.style.width=(i/pdf.numPages*90)+"%";
      }
      text=pages;
    }else{
      setStatus("מריץ OCR...");bar.style.width="20%";
      const {data:{text:ocr}}=await Tesseract.recognize(file,'heb+eng',{
        logger:m=>{if(m.progress)bar.style.width=(m.progress*80+20)+"%";}
      });
      text=ocr;
    }
    bar.style.width="100%";setStatus("הסתיים בהצלחה!","#090");
    out.textContent=text.trim();
  }catch(e){setStatus("שגיאה: "+e.message,"#c00")}
};
</script>
</body>
</html>
