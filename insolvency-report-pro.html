<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>×“×•"×— ××¡×›× ×œ×“×™×•×Ÿ ×¦×• ×©×™×§×•×</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      direction: rtl;
      text-align: right;
      margin: 0;
      background: #e5f6ff;
      font-size: 12px;
    }

    .top-bar {
      background: #0f766e;
      color: #fff;
      padding: 10px 18px;
      font-size: 18px;
      font-weight: 700;
      text-align: center;
    }

    .page {
      max-width: 1100px;
      margin: 8px auto;
      padding: 8px;
    }

    .card {
      background: #f8fafc;
      border-radius: 14px;
      border: 1px solid #dbeafe;
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.06);
      padding: 8px 10px;
      margin-bottom: 8px;
      page-break-inside: avoid;
      break-inside: avoid;
    }

    .section-title {
      font-size: 13px;
      font-weight: 700;
      color: #0f172a;
      text-align: right;
      margin: 0;
    }

    .section-header-flex {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-bottom: 4px;
      padding-bottom: 2px;
      border-bottom: 1px solid #e2e8f0;
    }

    .sub-title {
      font-size: 12px;
      font-weight: 600;
      color: #0f766e;
      margin: 4px 0 2px;
      text-align: right;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .no-wrap {
      flex-wrap: nowrap;
    }

    label {
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 2px;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="month"],
    input[type="time"],
    textarea,
    select {
      font-size: 11px;
      padding: 3px 5px;
      border-radius: 8px;
      border: 1px solid #cbd5f5;
      background: #ffffff;
      min-width: 0;
      font-weight: 600;
      color: #1d4ed8;
    }

    textarea {
      resize: vertical;
    }

    .short   { width: 80px; }
    .tiny    { width: 50px; }
    .mini    { width: 30px; }
    .medium  { width: 120px; }
    .xshort  { width: 60px; }
    .flex-1  { flex: 1 1 0; }

    .small-text {
      font-size: 11px;
      color: #64748b;
    }

    hr {
      border: none;
      border-top: 1px dashed #e2e8f0;
      margin: 4px 0;
    }

    .layout-main {
      display: grid;
      grid-template-columns: 1.1fr 1.9fr;
      gap: 8px;
      align-items: flex-start;
    }

    .footer {
      text-align: center;
      font-size: 11px;
      color: #475569;
      margin-top: 6px;
    }

    .buttons-inline {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 0;
    }

    .btn {
      border: none;
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 11px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-print   { background: #0ea5e9; color: #fff; }
    .btn-email   { background: #6366f1; color: #fff; }
    .btn-shot    { background: #0f766e; color: #fff; }
    .btn-reset   { background: #fef2f2; color: #b91c1c; border: 1px solid #fecaca; }
    .btn-restore { background: #eef2ff; color: #1e3a8a; border: 1px solid #c7d2fe; }

    .allowances-title-row {
      justify-content: flex-start;
    }
    .allowance-title {
      color: #15803d;
      font-weight: 700;
      text-align: right;
      width: auto;
    }

    .medical-notes-row input {
      width: 100%;
    }

    .order-box {
      border: 2px solid #0f766e;
      border-radius: 12px;
      padding: 6px 8px;
      background: #ecfeff;
    }

    .hearing-box {
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      padding: 4px 6px;
      background: #eff6ff;
      margin-top: 2px;
    }

    .calc-frame-card {
      margin-top: 6px;
      flex: 1 1 auto;
      page-break-inside: avoid;
      break-inside: avoid;
    }
    .calc-frame-card iframe {
      width: 100%;
      border: 0;
      border-radius: 12px;
      height: 380px;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1);
      background: #ffffff;
    }

    #familyIncomeTotal { color: #15803d; }
    #familyExpensesTotal { color: #b91c1c; }

    .status-ok {
      color: #15803d;
      font-weight: 700;
    }
    .status-bad {
      color: #b91c1c;
      font-weight: 700;
    }

    .not-working-section label,
    .not-working-section input,
    .not-working-section select {
      color: #b91c1c;
      border-color: #fecaca;
    }

    .pair {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .pair-label-multiline {
      display: inline-block;
      line-height: 1.1;
          .debts-row {
      flex-wrap: nowrap;
      justify-content: flex-start;
      gap: 10px;
    }

    .pair-label-multiline {
      display: inline-block;
      max-width: 60px;
      line-height: 1.1;
      white-space: normal;
      text-align: right;
    }

    }

    .docs-row .arrears-label {
      margin-inline-start: 12px;
    }

    .recom-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 4px;
      align-items: flex-start;
    }
    .recom-item {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .recom-item label {
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .recom-item input {
      width: auto;
      max-width: 100%;
    }

    .recom-total {
      background: #fef9c3;
      font-weight: 700;
    }

    .order-box-comm {
      border-color: #6366f1;
      background: #eef2ff;
    }

    .scroll-top-btn {
      position: fixed;
      bottom: 16px;
      left: 16px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid #cbd5e1;
      background: #ffffff;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.2);
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      z-index: 50;
    }

    @media print {
      @page { size: A4 portrait; margin: 5mm; }

      body { background: #ffffff; font-size: 11px; }
      .top-bar { border-bottom: 1px solid #cbd5e1; box-shadow: none; }
      .page {
        max-width: 100%;
        margin: 0;
        padding: 4mm;
        transform: scale(0.86);
        transform-origin: top center;
      }
      .card { box-shadow: none; }
      .buttons-inline { display: none; }
      .calc-frame-card { display: none; }
      .scroll-top-btn { display: none !important; }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    ×“×•"×— ××¡×›× ×œ×“×™×•×Ÿ ×¦×• ×©×™×§×•×-105
  </div>

  <form id="reportForm">
    <div class="page">

      <!-- ×›×¨×˜×™×¡ ×¢×œ×™×•×Ÿ â€“ ×¤×¨×˜×™ ×ª×™×§ + ×¦×• ×ª×©×œ×•××™× + ×¤×¨×˜×™× ××™×©×™×™× + ××¦×‘ ×¨×¤×•××™ -->
      <div class="card">
        <div class="section-header-flex">
          <div class="section-title">×¤×¨×˜×™ ×ª×™×§ ×•×¦×• ×ª×©×œ×•××™×</div>
          <div class="buttons-inline">
            <button type="button" class="btn btn-print" onclick="window.print()">ğŸ–¨ ×”×“×¤×¡×” / PDF</button>
            <button type="button" class="btn btn-email" onclick="sendEmail()">âœ‰ ×©×œ×™×—×” ×‘××™×™×œ</button>
            <button type="button" class="btn btn-shot" onclick="screenshotReport()">ğŸ“¸ ×¦×™×œ×•× ××¡×š</button>
            <button type="button" class="btn btn-reset" onclick="document.getElementById('reportForm').reset()">â†º ××™×¤×•×¡</button>
            <button type="button" class="btn btn-restore" onclick="restoreFormState()">ğŸ” ×©×—×–×•×¨</button>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1.1fr 1fr 1.2fr;gap:8px;align-items:flex-start;">

          <!-- ×¢××•×“×” ×™××™×Ÿ: ×¤×¨×˜×™ ×ª×™×§ -->
          <div>
            <div class="sub-title">×¤×¨×˜×™ ×ª×™×§</div>

            <div class="row">
              ×ª×™×§ ×××•× ×”:
              <input type="text" class="short" maxlength="5">
              ×ª×™×§ ×‘×™×”×"×©:
              <input type="text" class="short" placeholder="">
            </div>

            <div class="row">
              ×©× ×”×—×™×™×‘/×ª:
              <input type="text" class="short">
              ×©× ×”× ×××Ÿ:
              <input type="text" class="short">
            </div>

            <div class="row">
              ×ª××¨×™×š ×¦×•:
              <input type="date" id="orderDate" class="medium">
              ×œ×‘×§×©×ª:
              <label><input type="radio" name="order_by"> ×—×™×™×‘</label>
              <label><input type="radio" name="order_by"> × ×•×©×”</label>
            </div>

            <div class="hearing-box">
              <div class="row no-wrap">
                ××§×•× ×©×™×¤×•×˜:
                <input type="text" class="tiny">
                ×ª××¨×™×š ×“×™×•×Ÿ:
                <input type="date" class="medium">
              </div>
              <div class="row">
                ×©×¢×ª ×“×™×•×Ÿ:
                <input type="time" class="short" step="300">
              </div>
            </div>
          </div>

          <!-- ×¢××•×“×” ×××¦×¢: ×¦×• ×ª×©×œ×•××™× ×‘×œ×‘×“ ×‘××¡×’×¨×ª -->
          <div>
            <div class="order-box">
              <div class="sub-title">×¦×• ×ª×©×œ×•××™×</div>

              <div class="row no-wrap">
                ×ª×©×œ×•× ×—×•×“×©×™:
                <input type="text" id="monthlyPayment" class="xshort currency-input" maxlength="6">
              </div>

              <div class="row no-wrap">
                ×ª×©×œ×•× ××“×•×¨×’:
                <input type="text" id="gradedPayment" class="xshort currency-input" maxlength="6" placeholder="">
                ××™×•×:
                <input type="date" id="gradedFromDate" class="medium">
              </div>

              <div class="row">
                ××¡×™×¨×” ×œ× ×•×©×™×:
                <label><input type="radio" name="notices"> ×›×Ÿ</label>
                <label><input type="radio" name="notices"> ×œ×</label>
              </div>

              <hr>

              <div class="row no-wrap">
                ×¡×”"×› × ×›×•×Ÿ ×œ×™×•×:
                <input type="text" id="paymentsTotalDate" class="short" readonly>
              </div>

              <div class="row">
                <input type="text" id="paymentsTotalAmount" class="short currency-input" readonly>
              </div>
            </div>
          </div>

          <!-- ×¢××•×“×” ×©×××œ: ×¤×¨×˜×™× ××™×©×™×™× + ××¦×‘ ×¨×¤×•××™ -->
          <div>
            <div class="sub-title">×¤×¨×˜×™× ××™×©×™×™×</div>

            <div class="row" style="flex-wrap:wrap;">
              ××¦×‘ ××©×¤×—×ª×™:
              <label><input type="radio" name="family_status" value="×¨×•×•×§"> ×¨×•×•×§</label>
              <label><input type="radio" name="family_status" value="× ×©×•×™"> × ×©×•×™</label>
              <label><input type="radio" name="family_status" value="×’×¨×•×©"> ×’×¨×•×©</label>
              <label><input type="radio" name="family_status" value="××œ××Ÿ"> ××œ××Ÿ</label>
            </div>

           <div class="row">
  ×™×œ×“×™× ×§×˜×™× ×™×:
  <input type="number" id="minorChildrenCount" class="short" min="0" max="11">
  ×ª×©×œ×•× ××–×•× ×•×ª:
  <label><input type="checkbox" id="hasAlimony"> ×›×Ÿ</label>
  <input type="text" id="alimonyAmount" class="short currency-input">
</div>

            <hr>

            <div class="sub-title">××¦×‘ ×¨×¤×•××™ ×•××™×©×•×¨×™ ××œ"×œ</div>

            <div class="row">
              × ×›×•×ª:
              <input type="text" class="short percent-field" id="disabilityPercent" maxlength="3" placeholder="0%">
              ××™ ×›×•×©×¨:
              <input type="text" class="short percent-field" id="incapacityPercent" maxlength="3" placeholder="0%">
            </div>

            <div class="row allowances-title-row">
              <span class="allowance-title">×§×¦×‘××•×ª</span>
            </div>
            <div class="row" style="justify-content:flex-start;flex-wrap:wrap;">
              <label><input type="checkbox"> ×§×¦×‘×ª ×™×œ×“ × ×›×”</label>
              <label><input type="checkbox"> ×”×‘×˜×—×ª ×”×›× ×¡×”</label>
              <label><input type="checkbox"> ×¡×™×•×¢ ×©×›"×“</label>
            </div>

            <div class="row medical-notes-row">
              ×‘×¢×™×•×ª ×¨×¤×•××™×•×ª (×ª××¦×™×ª×™):
              <input type="text" class="flex-1">
            </div>
          </div>

        </div>
      </div>

      <!-- ×©×ª×™ ×¢××•×“×•×ª â€“ ×©×××œ: ×”×ª× ×”×œ×•×ª/×—×•×‘×•×ª/× ×›×¡×™×/×¡×™×›×•×, ×™××™×Ÿ: ×”×›× ×¡×•×ª + ××—×©×‘×•×Ÿ -->
      <div class="layout-main">

        <!-- ×¢××•×“×” ×©×××œ×™×ª -->
        <div>

          <!-- ×›×¨×˜×™×¡ ×”×ª× ×”×œ×•×ª, ×—×•×‘×•×ª ×•× ×›×¡×™× -->
          <div class="card">
            <div class="section-title" style="border-bottom:1px solid #e2e8f0;padding-bottom:2px;margin-bottom:4px;">
              ×”×ª× ×”×œ×•×ª ×”×—×™×™×‘, ×—×•×‘×•×ª ×•× ×›×¡×™×
            </div>

            <!-- ×”×ª× ×”×œ×•×ª ×”×—×™×™×‘ -->
            <div class="sub-title">×”×ª× ×”×œ×•×ª ×”×—×™×™×‘</div>

            <div class="small-text">×“×•"×—×•×ª ×—×•×“×©×™×™×:</div>
            <div class="row">
              <label class="reports-status-full">
                <input type="radio" name="reports_status" value="full"> ×”×•×’×©×•
              </label>
              <label class="reports-status-partial">
                <input type="radio" name="reports_status" value="partial"> ×”×•×’×©×• ×—×œ×§×™×ª
              </label>
              <label class="reports-status-none">
                <input type="radio" name="reports_status" value="none"> ×œ× ×”×•×’×©×• ×›×œ×œ
              </label>
            </div>

            <div class="row">
              ×”×¢×¨×•×ª ×“×•"×—×•×ª:
              <input type="text" class="flex-1">
            </div>

            <div class="sub-title" style="margin-top:4px;">××¡××›×™× ×•×ª×©×œ×•××™×</div>
            <div class="row docs-row">
              <span>××¡××›×™× ×—×¡×¨×™×:</span>
              <label><input type="radio" name="missing_docs"> ×›×Ÿ</label>
              <label><input type="radio" name="missing_docs"> ×œ×</label>
              <span class="arrears-label">×¡×š ×¤×™×’×•×¨×™×:</span>
              <input type="text" class="short currency-input">
            </div>

            <hr>

            <!-- ×—×•×‘×•×ª -->
            <div class="sub-title">×—×•×‘×•×ª</div>

            <div class="row debts-row">
              <span class="pair">
                <span class="pair-label-multiline">××¡' × ×•×©×™×</span>
                <input type="number" class="tiny" min="0" max="99">
              </span>

              <span class="pair">
                <span class="pair-label-multiline">×¡×›×•× ×›×•×œ×œ</span>
                <input type="text" class="short currency-input">
              </span>

              <span class="pair">
                <span class="pair-label-multiline">×“×™×Ÿ ×§×“×™××”</span>
                <input type="text" class="short currency-input">
              </span>
            </div>

            <div class="row">
              ×ª×‘×™×¢×•×ª ×—×•×‘ × ×‘×“×§×•:
              <label><input type="radio" name="claims_checked"> ×›×Ÿ</label>
              <label><input type="radio" name="claims_checked"> ×œ×</label>
            </div>

           <div class="sub-title">×—×•×‘×•×ª ×œ× ×‘×¨×™ ×”×¤×˜×¨</div>
<div class="row" style="flex-wrap:wrap;">
  <span class="pair">
    <label><input type="checkbox" id="alimonyDebtChk"> ××–×•× ×•×ª</label>
    <input type="text" id="alimonyDebtAmount" class="short currency-input" min="0" max="99999"> <!-- ×”×•×¡×¤×ª×™ ××ª ×”××—×œ×§×” currency-input -->
  </span>
  <span class="pair">
    <label><input type="checkbox" id="taxDebtChk"> ×¨×©×•×™×•×ª ××›×™×¤×”</label>
    <input type="text" id="taxDebtAmount" class="short currency-input" min="0" max="99999"> <!-- ×”×•×¡×¤×ª×™ ××ª ×”××—×œ×§×” currency-input -->
  </span>
</div>

            <hr>

            <!-- × ×›×¡×™× -->
            <div class="sub-title">× ×›×¡×™×</div>

            <div class="row">
              <label><input type="checkbox"> ×“×™×¨×ª ××’×•×¨×™×</label>
              <label><input type="checkbox"> × ×›×¡</label>
              <label><input type="checkbox"> ×¨×›×‘</label>
              <label><input type="checkbox"> ×–×›×•×™×•×ª</label>
            </div>

            <div class="row">
              ×”×¢×¨×›×ª ×©×•×•×™:
              <input type="text" class="short currency-input">
            </div>
          </div>

          <!-- ×›×¨×˜×™×¡ ×¡×™×›×•× ×•×”××œ×¦×•×ª -->
          <div class="card">
            <div class="section-title" style="border-bottom:1px solid #e2e8f0;padding-bottom:2px;margin-bottom:4px;">
              ×¡×™×›×•× ×•×”××œ×¦×•×ª
            </div>

            <!-- ×¡×™×›×•× ×”× ×××Ÿ -->
            <div class="row" style="justify-content:space-between;align-items:center;">
              <div class="sub-title" style="margin-bottom:0;">×¡×™×›×•× ×”× ×××Ÿ</div>
              <label><input type="checkbox"> ×”×›×©×¨×” ×›×œ×›×œ×™×ª</label>
            </div>
            <div class="row">
              <textarea rows="2" class="flex-1" placeholder="×ª××¦×™×ª ×¢××“×ª ×”× ×××Ÿ (×©×ª×™ ×©×•×¨×•×ª)"></textarea>
            </div>

            <!-- ×”××œ×¦×ª × ×××Ÿ -->
            <div class="row" style="justify-content:flex-start;align-items:center;">
              <div class="sub-title" style="margin-bottom:0;">×”××œ×¦×ª × ×××Ÿ</div>
            </div>
            <div class="order-box" style="margin-top:2px;">
              <div class="recom-grid">
                <div class="recom-item">
                  <label>×¡×›×•× ×—×•×“×©×™</label>
                  <input type="text" id="trusteeMonthly" class="currency-input xshort" maxlength="6">
                </div>
                <div class="recom-item">
                  <label>××©×š</label>
                  <input type="number" id="trusteeDuration" class="tiny" min="0" max="99">
                </div>
                <div class="recom-item">
                  <label>×¡×›×•× ×›×•×œ×œ</label>
                  <input type="text" id="trusteeTotal" class="currency-input xshort recom-total" readonly>
                </div>
              </div>
            </div>

            <!-- ×¡×™×›×•× ×”×××•× ×” -->
            <div class="row" style="justify-content:space-between;align-items:center;margin-top:6px;">
              <div class="sub-title" style="margin-bottom:0;">×¡×™×›×•× ×”×××•× ×”</div>
              <label><input type="checkbox"> ×”×›×©×¨×” ×›×œ×›×œ×™×ª</label>
            </div>
            <div class="row">
              <textarea rows="2" class="flex-1" placeholder="×ª××¦×™×ª ×¢××“×ª ×”×××•× ×” (×©×ª×™ ×©×•×¨×•×ª)"></textarea>
            </div>

            <!-- ×”××œ×¦×ª ×”×××•× ×” -->
            <div class="row" style="justify-content:flex-start;align-items:center;">
              <div class="sub-title" style="margin-bottom:0;">×”××œ×¦×ª ×”×××•× ×”</div>
            </div>
            <div class="order-box order-box-comm" style="margin-top:2px;">
              <div class="recom-grid">
                <div class="recom-item">
                  <label>×¡×›×•× ×—×•×“×©×™</label>
                  <input type="text" id="commMonthly" class="currency-input xshort" maxlength="6">
                </div>
                <div class="recom-item">
                  <label>××©×š</label>
                  <input type="number" id="commDuration" class="tiny" min="0" max="99">
                </div>
                <div class="recom-item">
                  <label>×¡×›×•× ×›×•×œ×œ</label>
                  <input type="text" id="commTotal" class="currency-input xshort recom-total" readonly>
                </div>
              </div>
            </div>

            <div class="row">
              × ×™××•×§×™× ×œ×”××œ×¦×ª ×”×××•× ×”:
              <textarea rows="2" class="flex-1" placeholder="× ×™××•×§×™× ×§×¦×¨×™×"></textarea>
            </div>
          </div>

        </div>

        <!-- ×¢××•×“×” ×™×× ×™×ª: ×”×›× ×¡×•×ª + ××—×©×‘×•×Ÿ -->
        <div class="card" style="display:flex;flex-direction:column;">
          <div class="section-title" style="border-bottom:1px solid #e2e8f0;padding-bottom:2px;margin-bottom:4px;">
            ×”×›× ×¡×•×ª ×”×—×™×™×‘, ×‘×Ÿ/×‘×ª ×”×–×•×’ ×•××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™×
          </div>

          <!-- ×”×›× ×¡×•×ª ×”×—×™×™×‘ -->
          <div class="sub-title">×”×›× ×¡×•×ª ×”×—×™×™×‘</div>

          <div class="row" style="flex-wrap:wrap;">
            ××§×¦×•×¢:
            <input type="text" class="short">
            ××§×•× ×¢×‘×•×“×”:
            <input type="text" class="short">
            ×”×™×§×£ ××©×¨×”:
            <input type="text" class="short">
            ×ª×—×™×œ×ª ×¢×‘×•×“×”:
            <input type="month" class="medium">
          </div>

        <div class="row not-working-toggle-row" id="debtorIncomeRow">
  ×©×›×¨ × ×˜×•:
  <input type="text" id="debtorNetIncome" class="short currency-input">
  <label><input type="checkbox" id="debtorNotWorking"> ×”×—×™×™×‘ ××™× ×• ×¢×•×‘×“</label>
</div>

<div class="row" id="earningPotentialRow">
  ×¤×•×˜× ×¦×™××œ ×”×©×ª×›×¨×•×ª:
  <input type="text" id="earningPotential" class="short currency-input">
</div>

<div class="row">
  ×”×¢×¨×•×ª:
  <input type="text" id="earningPotentialNotes" class="short">
</div>

<hr>
          
          <!-- ×”×›× ×¡×•×ª ×‘×Ÿ/×‘×ª ×”×–×•×’ -->
          <div class="sub-title">×”×›× ×¡×•×ª ×‘×Ÿ/×‘×ª ×”×–×•×’</div>

          <div class="row" style="flex-wrap:wrap;">
            ××§×¦×•×¢:
            <input type="text" class="short">
            ××§×•× ×¢×‘×•×“×”:
            <input type="text" class="short">
            ×”×™×§×£ ××©×¨×”:
            <input type="text" class="short">
            ×ª×—×™×œ×ª ×¢×‘×•×“×”:
            <input type="month" class="medium">
          </div>

          <div class="row not-working-toggle-row" id="spouseIncomeRow">
            ×©×›×¨ × ×˜×•:
            <input type="text" id="spouseNetIncome" class="short currency-input">
            <label><input type="checkbox" id="spouseNotWorking"> ×‘×Ÿ/×‘×ª ×”×–×•×’ ××™× ×•/×” ×¢×•×‘×“/×ª</label>
          </div>

          <hr>

          <!-- ×¡×š ×”×›× ×¡×•×ª ×•×”×•×¦××•×ª -->
          <div class="sub-title">×¡×š ×”×›× ×¡×•×ª ×•×”×•×¦××•×ª</div>

          <div class="row" style="flex-wrap:wrap;">
            ×¡×š ×”×›× ×¡×•×ª ×œ×ª× ×”××©×¤×—×ª×™:
            <input type="text" id="familyIncomeTotal" class="short currency-input">
            ×¡×š ×”×•×¦××•×ª ×œ×ª× ×”××©×¤×—×ª×™:
            <input type="text" id="familyExpensesTotal" class="short currency-input">
          </div>

          <!-- ××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™× -->
          <div class="calc-frame-card">
            <div class="sub-title">××—×©×‘×•×Ÿ ×¦×• ×ª×©×œ×•××™×</div>
            <iframe src="payment-order-calculator.html" loading="lazy"></iframe>
          </div>
        </div>
      </div>

      <div class="footer">
        × ×‘× ×” ×¢×œ ×™×“×™ ××œ×™××‘ ×™×—×™××œ
      </div>
    </div>
  </form>

  <button type="button" id="scrollTopBtn" class="scroll-top-btn">â†‘</button>

  <script>
    // ×¤×•×¨××˜ ××—×•×–×™× â€“ 3 ×¡×¤×¨×•×ª + %
    function setupPercentField(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('focus', () => {
        el.value = el.value.replace('%','').trim();
      });
      el.addEventListener('blur', () => {
        let v = el.value.replace(/[^\d]/g,'');
        if (!v) { el.value = ''; return; }
        if (v.length > 3) v = v.slice(0,3);
        el.value = v + '%';
      });
    }

    setupPercentField('disabilityPercent');
    setupPercentField('incapacityPercent');

    // ×¢×™×¦×•×‘ ×¡×›×•××™ ×›×¡×£ ×‘×›×œ ×”×˜×•×¤×¡
    function attachCurrencyFormatting() {
      const inputs = document.querySelectorAll(".currency-input");
      inputs.forEach(input => {
        input.addEventListener("focus", () => {
          const raw = input.value.replace(/[^\d.]/g, "");
          input.value = raw;
        });
        input.addEventListener("blur", () => {
          let v = input.value.replace(/[^\d.]/g, "");
          if (!v) {
            input.value = "";
            return;
          }
          const num = parseFloat(v.replace(/,/g, ""));
          if (!isNaN(num)) {
            input.value = num.toLocaleString("he-IL", {
              minimumFractionDigits: 0,
              maximumFractionDigits: 2
            }) + " â‚ª";
          }
        });
      });
    }

    function sendEmail() {
      const subject = encodeURIComponent('×“×•"×— ××¡×›× ×œ×“×™×•×Ÿ ×¦×• ×©×™×§×•×');
      const body = encodeURIComponent(
        '××¦×•×¨×£ ×“×•"×— ×¡×™×›×•× ×œ×“×™×•×Ÿ ×¦×• ×©×™×§×•× ×›×œ×›×œ×™.\n\n' +
        '(×œ×™×¦×™×¨×ª PDF â€“ ×”×©×ª××©/×™ ×‘×›×¤×ª×•×¨ ×”×“×¤×¡×” ×•×©××•×¨/×™ ×›-PDF, ×•×œ××—×¨ ××›×Ÿ ×¦×¨×£/×™ ××ª ×”×§×•×‘×¥ ×œ××™×™×œ.)'
      );
      window.location.href = 'mailto:?subject=' + subject + '&body=' + body;
    }

    // ×¦×™×œ×•× ××¡×š ×©×œ ×”×“×•"×—
    function screenshotReport() {
      const root = document.querySelector('.page');
      if (!root) return;
      html2canvas(root, {useCORS:true,allowTaint:true,scale:2,backgroundColor:'#ffffff'})
        .then(canvas => {
          const data = canvas.toDataURL('image/png');
          const w = window.open('','_blank');
          w.document.write('<img src="'+data+'" style="max-width:100%;display:block;margin:0 auto">');
          w.document.title = '×¦×™×œ×•× ×“×•"×— ×¡×™×›×•×';
        })
        .catch(() => alert('×©×’×™××” ×‘×™×¦×™×¨×ª ×¦×™×œ×•× ×”××¡×š'));
    }

    // "××™× ×• ×¢×•×‘×“" â€“ ×¦×‘×™×¢×” ×‘××“×•×
    function setupNotWorkingToggle(checkboxId, rowId) {
      const chk = document.getElementById(checkboxId);
      const row = document.getElementById(rowId);
      if (!chk || !row) return;
      function update() {
        if (chk.checked) {
          row.classList.add('not-working-section');
        } else {
          row.classList.remove('not-working-section');
        }
      }
      chk.addEventListener('change', update);
      update();
    }

    // ×“×•"×—×•×ª ×—×•×“×©×™×™× â€“ ×¦×‘×¢ ×œ×¤×™ ×¡×™××•×Ÿ
    function setupReportsStatusColors() {
      const radios = document.querySelectorAll('input[name="reports_status"]');
      if (!radios.length) return;

      function update() {
        const fullLabel = document.querySelector('.reports-status-full');
        const noneLabel = document.querySelector('.reports-status-none');
        if (fullLabel) fullLabel.classList.remove('status-ok','status-bad');
        if (noneLabel) noneLabel.classList.remove('status-ok','status-bad');

        const checked = document.querySelector('input[name="reports_status"]:checked');
        if (!checked) return;

        if (checked.value === 'full' && fullLabel) {
          fullLabel.classList.add('status-ok');
        }
        if (checked.value === 'none' && noneLabel) {
          noneLabel.classList.add('status-bad');
        }
      }

      radios.forEach(r => r.addEventListener('change', update));
      update();
    }

    // ×¢×–×¨: ×”××¨×ª ×˜×§×¡×˜ ×¡×›×•× ×œ××¡×¤×¨
    function parseNumberFromCurrency(val) {
      if (!val) return 0;
      const clean = String(val).replace(/[^\d.]/g,'');
      const num = parseFloat(clean);
      return isNaN(num) ? 0 : num;
    }

    // ×—×™×©×•×‘ ×¡×›×•××™× ×›×•×œ×œ×™× ×‘×”××œ×¦×•×ª (× ×××Ÿ/×××•× ×”)
    function updateRecommendationTotals() {
      const tm = document.getElementById('trusteeMonthly');
      const td = document.getElementById('trusteeDuration');
      const tt = document.getElementById('trusteeTotal');

      const cm = document.getElementById('commMonthly');
      const cd = document.getElementById('commDuration');
      const ct = document.getElementById('commTotal');

      if (tm && td && tt) {
        const m = parseNumberFromCurrency(tm.value);
        const d = parseInt(td.value || '0', 10) || 0;
        const total = m * d;
        tt.value = total ? total.toLocaleString('he-IL', {minimumFractionDigits:0, maximumFractionDigits:2}) + ' â‚ª' : '';
      }

      if (cm && cd && ct) {
        const m2 = parseNumberFromCurrency(cm.value);
        const d2 = parseInt(cd.value || '0', 10) || 0;
        const total2 = m2 * d2;
        ct.value = total2 ? total2.toLocaleString('he-IL', {minimumFractionDigits:0, maximumFractionDigits:2}) + ' â‚ª' : '';
      }
    }

function calculatePaymentsTotals() {
  const orderDateInput   = document.getElementById('orderDate');
  const monthlyInput     = document.getElementById('monthlyPayment');
  const gradedInput      = document.getElementById('gradedPayment');
  const gradedDateInput  = document.getElementById('gradedFromDate');
  const totalDateInput   = document.getElementById('paymentsTotalDate');
  const totalAmountInput = document.getElementById('paymentsTotalAmount');

  if (!orderDateInput || !monthlyInput || !totalDateInput || !totalAmountInput) return;

  const today = new Date();
  totalDateInput.value = today.toLocaleDateString('he-IL');

  if (!orderDateInput.value) {
    totalAmountInput.value = '';
    return;
  }

  const orderDate = new Date(orderDateInput.value);
  if (isNaN(orderDate)) {
    totalAmountInput.value = '';
    return;
  }

  const monthlyAmount = parseNumberFromCurrency(monthlyInput.value);
  const gradedAmount  = gradedInput ? parseNumberFromCurrency(gradedInput.value) : 0;
  const gradedDateVal = gradedDateInput ? gradedDateInput.value : '';

  if (!monthlyAmount && !gradedAmount) {
    totalAmountInput.value = '';
    return;
  }

  // ×¤×•× ×§×¦×™×” ×œ×¢×‘×•×“×” ×‘×¨××ª "×—×•×“×©" (×©× ×”*12 + ×—×•×“×©)
  const toIndex = (y,m) => y*12 + m; // m: 0-11
  const monthDiffInclusive = (startIndex, endIndex) => {
    const diff = endIndex - startIndex + 1;
    return diff > 0 ? diff : 0;
  };

  const firstPayMonthDate = new Date(orderDate.getTime());
  firstPayMonthDate.setMonth(firstPayMonthDate.getMonth() + 1); // ×”×—×•×“×© ××—×¨×™ ×”×¦×•

  const firstY = firstPayMonthDate.getFullYear();
  const firstM = firstPayMonthDate.getMonth(); // 0-11

  const todayY = today.getFullYear();
  const todayM = today.getMonth();

  const firstIdx = toIndex(firstY, firstM);
  const todayIdx = toIndex(todayY, todayM);

  // ×× ×× ×—× ×• ×œ×¤× ×™ ×”×—×•×“×© ×”×¨××©×•×Ÿ ×œ×ª×©×œ×•× â€“ ××™×Ÿ ×ª×©×œ×•×
  if (todayIdx < firstIdx) {
    totalAmountInput.value = '';
    return;
  }

  let total = 0;

  if (!gradedAmount || !gradedDateVal) {
    // ××™×Ÿ ××“×•×¨×’ â€“ ×”×›×œ ×œ×¤×™ ×”×—×•×“×©×™
    const monthsAll = monthDiffInclusive(firstIdx, todayIdx);
    total = monthsAll * monthlyAmount;
  } else {
    const gradedDate = new Date(gradedDateVal);
    if (isNaN(gradedDate)) {
      const monthsAll = monthDiffInclusive(firstIdx, todayIdx);
      total = monthsAll * monthlyAmount;
    } else {
      const gY = gradedDate.getFullYear();
      const gM = gradedDate.getMonth(); // ×”××“×•×¨×’ ××ª×—×™×œ ×‘×—×•×“×© ×–×”
      const gIdx = toIndex(gY, gM);

      // ×× ×”××“×•×¨×’ ×‘×¢×ª×™×“ ×‘×™×—×¡ ×œ×”×™×•× â€“ ××ª×¢×œ××™× ××× ×•
      if (gIdx > todayIdx) {
        const monthsAll = monthDiffInclusive(firstIdx, todayIdx);
        total = monthsAll * monthlyAmount;
      } else {
        // ×× ×”××“×•×¨×’ ××ª×—×™×œ ×œ×¤× ×™ ××• ×¢× ×ª×—×™×œ×ª ×”×ª×©×œ×•××™× â€“ ×”×›×œ ××“×•×¨×’
        if (gIdx <= firstIdx) {
          const monthsAll = monthDiffInclusive(firstIdx, todayIdx);
          const useAmount = gradedAmount || monthlyAmount;
          total = monthsAll * useAmount;
        } else {
          // ×©×œ×‘ 1: ×—×•×“×©×™× ×¨×’×™×œ×™× â€“ ××”×—×•×“×© ×”×¨××©×•×Ÿ ×œ×ª×©×œ×•× ×¢×“ ×”×—×•×“×© ×©×œ×¤× ×™ ×”××“×•×¨×’
          const beforeEndIdx = gIdx - 1;
          const monthsBefore = monthDiffInclusive(firstIdx, beforeEndIdx);

          // ×©×œ×‘ 2: ×—×•×“×©×™× ××“×•×¨×’×™× â€“ ××—×•×“×© ×”××“×•×¨×’ ×•×¢×“ ×”×™×•×
          const monthsAfter = monthDiffInclusive(gIdx, todayIdx);

          total = (monthsBefore * monthlyAmount) + (monthsAfter * gradedAmount);
        }
      }
    }
  }

  if (!total) {
    totalAmountInput.value = '';
  } else {
    totalAmountInput.value = total.toLocaleString('he-IL', {
      minimumFractionDigits: 0,
      maximumFractionDigits: 2
    }) + ' â‚ª';
  }
}

   // ----- ×¡× ×›×¨×•×Ÿ ×˜×•×¤×¡ â† ××—×©×‘×•×Ÿ ×‘××™×™×¤×¨×™×™× -----
let calcFrame = null;
let calcReady = false;

function syncCalculatorFromForm() {
  if (!calcReady || !calcFrame || !calcFrame.contentWindow) return;

  const w   = calcFrame.contentWindow;
  const doc = w.document;
  if (!doc) return;

  const debtorIncomeEl = document.getElementById('debtorNetIncome');
  const spouseIncomeEl = document.getElementById('spouseNetIncome');
  const kidsEl         = document.getElementById('minorChildrenCount');
  const alimonyChk     = document.getElementById('hasAlimony');
  const alimonyAmtEl   = document.getElementById('alimonyAmount');

  const debtorNet  = debtorIncomeEl ? parseNumberFromCurrency(debtorIncomeEl.value) : 0;
  const spouseNet  = spouseIncomeEl ? parseNumberFromCurrency(spouseIncomeEl.value) : 0;
  const kidsCount  = kidsEl ? (parseInt(kidsEl.value || '0', 10) || 0) : 0;
  const hasAlimony = alimonyChk ? alimonyChk.checked : false;
  const alimonyAmt = alimonyAmtEl ? parseNumberFromCurrency(alimonyAmtEl.value) : 0;

  // ×©×›×¨ ×—×™×™×‘
  const salaryDebtor = doc.getElementById('salaryDebtor');
  if (salaryDebtor) {
    salaryDebtor.value = debtorNet || '';
    salaryDebtor.dispatchEvent(new w.Event('input', {bubbles:true}));
  }

  // ×©×›×¨ ×‘×Ÿ/×‘×ª ×–×•×’
  const salaryPartner = doc.getElementById('salaryPartner');
  if (salaryPartner) {
    salaryPartner.value = spouseNet || '';
    salaryPartner.dispatchEvent(new w.Event('input', {bubbles:true}));
  }

  // ×™×œ×“×™× â€“ ×¢×“×›×•×Ÿ childrenCount ×‘×ª×•×š ×”××—×©×‘×•×Ÿ (××•×’×“×¨ ×©× ×¢× let, ×œ× ×¢×œ window)
  try {
    const n = Math.max(0, Math.min(10, kidsCount));
    if (typeof w.eval === 'function') {
      // ××¢×“×›× ×™× ××ª ×”××©×ª× ×” ×”×’×œ×•×‘×œ×™ ×‘××™×™×¤×¨×™×™×
      w.eval('childrenCount = ' + n + ';');
      if (typeof w.updateChildrenLabel === 'function') {
        w.updateChildrenLabel();
      }
    }
  } catch (e) {
    // ×× ××¡×™×‘×” ×›×œ×©×”×™ ××™×Ÿ ×’×™×©×” â€“ ××ª×¢×œ××™×
  }
  // ××–×•× ×•×ª â€“ ×¨×§ ×× ××¡×•××Ÿ ×‘×˜×•×¤×¡
  const alimonyInput = doc.getElementById('alimonyExpenses');
  if (alimonyInput) {
    if (hasAlimony && alimonyAmt > 0) {
      alimonyInput.value = alimonyAmt;
    } else {
      alimonyInput.value = '';
    }
    alimonyInput.dispatchEvent(new w.Event('input', {bubbles:true}));
  }

  // ××¦×‘ ××©×¤×—×ª×™ â†’ ×¡×˜×˜×•×¡ ×‘××—×©×‘×•×Ÿ
  const familyRadios = document.querySelectorAll('input[name="family_status"]');
  let familyValue = '';
  familyRadios.forEach(r => { if (r.checked) familyValue = r.value; });

  let targetType = null; // "×™×—×™×“" / "×–×•×’" / "×¨×•×•×§"
  if (familyValue === '× ×©×•×™') {
    targetType = '×–×•×’';
  } else if (familyValue === '×¨×•×•×§' || familyValue === '×’×¨×•×©' || familyValue === '××œ××Ÿ') {
    targetType = '×¨×•×•×§';
  }

  if (targetType) {
    const ftButtons = doc.querySelectorAll('.family-type');
    ftButtons.forEach(btn => {
      if (btn.dataset.type === targetType) {
        btn.click();
      }
    });
  }

  // ×—×™×©×•×‘ ××—×“×© ×‘××—×©×‘×•×Ÿ
  if (typeof w.calc === 'function') {
    w.calc();
  }
}

function initCalculatorSync() {
  calcFrame = document.querySelector('.calc-frame-card iframe');
  if (!calcFrame) return;
  calcFrame.addEventListener('load', () => {
    calcReady = true;
    syncCalculatorFromForm();
  });
}
    // ----- ×©××™×¨×ª/×©×—×–×•×¨ ××¦×‘ ×˜×•×¤×¡ -----

    function saveFormState() {
      const form = document.getElementById('reportForm');
      if (!form) return;
      const fields = form.querySelectorAll('input, textarea, select');
      const data = [];
      fields.forEach((el) => {
        data.push({
          type: el.type,
          tag: el.tagName,
          value: el.value,
          checked: el.checked || false
        });
      });
      try {
        localStorage.setItem('insolvencyReportFormV2', JSON.stringify(data));
      } catch (e) {}
    }

    function restoreFormState() {
      const form = document.getElementById('reportForm');
      if (!form) return;
      let data;
      try {
        data = JSON.parse(localStorage.getItem('insolvencyReportFormV2') || 'null');
      } catch (e) {
        data = null;
      }
      if (!Array.isArray(data)) {
        alert('×œ× × ××¦××• × ×ª×•× ×™× ×œ×©×—×–×•×¨.');
        return;
      }
      const fields = form.querySelectorAll('input, textarea, select');
      fields.forEach((el, idx) => {
        const item = data[idx];
        if (!item) return;
        if (el.type === 'checkbox' || el.type === 'radio') {
          el.checked = !!item.checked;
        } else {
          el.value = item.value || '';
        }
      });

      setupReportsStatusColors();
      setupNotWorkingToggle('debtorNotWorking', 'debtorIncomeRow');
      setupNotWorkingToggle('spouseNotWorking', 'spouseIncomeRow');
      attachCurrencyFormatting();
      updateRecommendationTotals();
      calculatePaymentsTotals();
      syncCalculatorFromForm();
      alert('×”× ×ª×•× ×™× ×©×•×—×–×¨×• ××”×’×¨×¡×” ×”××—×¨×•× ×” ×©× ×©××¨×”.');
    }

    // ×—×¥ ×—×–×¨×” ×œ×¨××© ×”×“×£
    function setupScrollTopButton() {
      const btn = document.getElementById('scrollTopBtn');
      if (!btn) return;
      window.addEventListener('scroll', () => {
        if (window.scrollY > 200) {
          btn.style.display = 'flex';
        } else {
          btn.style.display = 'none';
        }
      });
      btn.addEventListener('click', () => {
        window.scrollTo({top: 0, behavior: 'smooth'});
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      attachCurrencyFormatting();
      setupNotWorkingToggle('debtorNotWorking', 'debtorIncomeRow');
      setupNotWorkingToggle('spouseNotWorking', 'spouseIncomeRow');
      setupReportsStatusColors();
      setupScrollTopButton();
      initCalculatorSync();

      const form = document.getElementById('reportForm');
      if (form) {
        form.addEventListener('input', (e) => {
          if (e.target && (
            e.target.id === 'trusteeMonthly' ||
            e.target.id === 'trusteeDuration' ||
            e.target.id === 'commMonthly' ||
            e.target.id === 'commDuration'
          )) {
            updateRecommendationTotals();
          }
          if (e.target && (
            e.target.id === 'orderDate' ||
            e.target.id === 'monthlyPayment' ||
            e.target.id === 'gradedPayment' ||
            e.target.id === 'gradedFromDate'
          )) {
            calculatePaymentsTotals();
          }

          saveFormState();
          syncCalculatorFromForm();
        });

        form.addEventListener('change', (e) => {
          if (e.target && (
            e.target.id === 'trusteeMonthly' ||
            e.target.id === 'trusteeDuration' ||
            e.target.id === 'commMonthly' ||
            e.target.id === 'commDuration'
          )) {
            updateRecommendationTotals();
          }
          if (e.target && (
            e.target.id === 'orderDate' ||
            e.target.id === 'monthlyPayment' ||
            e.target.id === 'gradedPayment' ||
            e.target.id === 'gradedFromDate'
          )) {
            calculatePaymentsTotals();
          }

          saveFormState();
          syncCalculatorFromForm();
        });
      }

      // ×—×™×©×•×‘ ×¨××©×•× ×™
      calculatePaymentsTotals();
    });
  </script>
</body>
</html>
