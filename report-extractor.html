<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>בדיקת טעינה — גרסה BUILD 2025-10-27-01</title>
  <style>body{background:#0b1220;color:#e6eef6;font-family:Arial;padding:24px} .card{background:#111a2b;padding:16px;border-radius:12px;border:1px solid #1e2b45}</style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
  <h1>בדיקת טעינה</h1>
  <div class="card">
    <p>אם אתה רואה את המספר: <b>BUILD 2025-10-27-01</b> — אתה על הדף המעודכן.</p>
    <input id="file" type="file" accept="application/pdf">
    <button id="go">בדוק PDF</button>
    <div id="out" style="margin-top:10px"></div>
  </div>

  <script>
    // חובה להגדיר worker ל-pdf.js
    if (window.pdfjsLib) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
    } else {
      alert("pdf.js לא נטען — רענן עם Ctrl+F5");
    }

    async function readPDF(buf){
      const pdf = await pdfjsLib.getDocument({data: buf}).promise;
      const first = await pdf.getPage(1);
      const tc = await first.getTextContent();
      return { pages: pdf.numPages, sample: tc.items.slice(0,5).map(i=>i.str).join(" ") };
    }

    document.getElementById("go").onclick = async ()=>{
      const f = document.getElementById("file").files[0];
      if(!f){ alert("בחר PDF"); return; }
      document.getElementById("out").textContent = "קורא...";
      try {
        const buf = await f.arrayBuffer();
        const info = await readPDF(buf);
        document.getElementById("out").textContent =
          "עמודים: " + info.pages + " | דוגמה: " + (info.sample || "(אין טקסט)");
      } catch(e){
        document.getElementById("out").textContent = "שגיאה: " + e.message;
      }
    };
  </script>
</body>
</html>
