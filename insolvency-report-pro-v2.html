document.addEventListener("DOMContentLoaded", () => {
  attachCurrencyFormatting();
  setupNotWorkingToggle('debtorNotWorking', 'debtorIncomeRow');
  setupNotWorkingToggle('spouseNotWorking', 'spouseIncomeRow');
  setupReportsStatusColors();
  setupScrollTopButton();

  const form = document.getElementById('reportForm');
  if (form) {
    form.addEventListener('input', (e) => {
      if (e.target && (
        e.target.id === 'trusteeMonthly' ||
        e.target.id === 'trusteeDuration' ||
        e.target.id === 'commMonthly' ||
        e.target.id === 'commDuration'
      )) {
        updateRecommendationTotals();
      }
      saveFormState();
      syncToCalculator();          // <<< סנכרון בכל שינוי
    });

    form.addEventListener('change', (e) => {
      if (e.target && (
        e.target.id === 'trusteeMonthly' ||
        e.target.id === 'trusteeDuration' ||
        e.target.id === 'commMonthly' ||
        e.target.id === 'commDuration'
      )) {
        updateRecommendationTotals();
      }
      saveFormState();
      syncToCalculator();          // <<< גם בשינויי רדיו/צ'קבוקס
    });
  }

  // כשה-iframe של המחשבון נטען – סנכרון ראשוני
  const frame = document.querySelector('.calc-frame-card iframe');
  if (frame) {
    frame.addEventListener('load', syncToCalculator);
  }
});
